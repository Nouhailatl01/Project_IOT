<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Monitoring Cha√Æne Froide DHT11</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { max-width: 1400px; margin: 0 auto; }
        
        /* HEADER */
        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .header h1 { font-size: 24px; color: #333; }
        
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .user-info { text-align: right; }
        .user-info p { font-size: 13px; color: #666; margin: 2px 0; }
        .user-name { font-weight: 600; color: #333; }
        
        .logout-btn {
            padding: 8px 16px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .logout-btn:hover { background: #d32f2f; }
        
        /* MAIN GRID */
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        /* CARD MEASUREMENT */
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title .icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .icon-temp { background: linear-gradient(135deg, #ff6b6b, #ff8e72); }
        .icon-hum { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .icon-incident { background: linear-gradient(135deg, #fa5252, #ff6348); }
        
        /* MEASUREMENTS DISPLAY */
        .measurements-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .measurement-box {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #f0f0f0;
        }
        
        .measurement-box.temp {
            background: linear-gradient(135deg, #fff5e6 0%, #ffe0b2 100%);
        }
        
        .measurement-box.hum {
            background: linear-gradient(135deg, #e0f7ff 0%, #b3e5fc 100%);
        }
        
        .measurement-label {
            font-size: 12px;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .measurement-value {
            font-size: 40px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .measurement-box.temp .measurement-value { color: #d97706; }
        .measurement-box.hum .measurement-value { color: #0891b2; }
        
        .measurement-unit {
            font-size: 14px;
            color: #666;
        }
        
        .measurement-time {
            font-size: 11px;
            color: #999;
            margin-top: 8px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .badge-ok { background: #c8e6c9; color: #2e7d32; }
        .badge-alert { background: #ffccbc; color: #d84315; }
        
        /* CHARTS - REMOVED - Now using dedicated graph pages */
        
        .links-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .btn {
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s;
            text-decoration: none;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        /* INCIDENT PANEL */
        .incident-box {
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid;
            margin-bottom: 15px;
        }
        
        .incident-ok {
            background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
            border-left-color: #48bb78;
        }
        
        .incident-alert {
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
            border-left-color: #f56565;
        }
        
        .incident-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .incident-info {
            font-size: 12px;
            color: #555;
            line-height: 1.6;
        }
        
        .incident-info strong { color: #333; }
        
        /* OPERATORS */
        .operators-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .op-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            opacity: 1;
            transition: all 0.3s;
            background: #ffffff;
        }
        
        .op-card.active {
            opacity: 1;
            border-color: #667eea;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .op-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .op-level {
            width: 28px;
            height: 28px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .op-name {
            font-weight: 600;
            font-size: 13px;
            color: #333;
        }
        
        .op-ack {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .op-ack input {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #667eea;
        }
        
        .op-comment {
            width: 100%;
            height: 50px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12px;
            font-family: inherit;
            margin-bottom: 8px;
            resize: vertical;
        }
        
        .op-comment:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn-validate {
            width: 100%;
            padding: 8px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-validate:hover { background: #764ba2; }
        
        .op-saved {
            font-size: 11px;
            color: #999;
            margin-top: 6px;
        }
        
        /* ALERTS */
        .alerts-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 350px;
        }
        
        .alert {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid;
        }
        
        .alert.success { border-left-color: #48bb78; background: #f0fff4; color: #22543d; }
        .alert.error { border-left-color: #f56565; background: #fff5f5; color: #742a2a; }
        
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* API TESTER */
        .api-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-top: 25px;
        }
        
        .api-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .api-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .api-input-group label {
            font-size: 12px;
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 5px;
        }
        
        .api-input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .api-input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn-send {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
        }
        
        .btn-send:hover { transform: translateY(-2px); box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4); }
        
        .api-response {
            margin-top: 12px;
            padding: 12px;
            background: #f9f9f9;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            color: #333;
            max-height: 120px;
            overflow-y: auto;
            display: none;
        }
        
        .api-response.show { display: block; }
        .api-response.success { background: #f0fff4; border-left: 3px solid #48bb78; }
        .api-response.error { background: #fff5f5; border-left: 3px solid #f56565; }
        
        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .main-grid { grid-template-columns: 1fr; }
            .charts-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>‚ùÑÔ∏è Cha√Æne Froide - Monitoring DHT11</h1>
            <div class="header-right">
                <div class="user-info">
                    <p>Op√©rateur</p>
                    <p class="user-name">{{ user.first_name|default:user.username }}</p>
                </div>
                <a href="{% url 'logout' %}" class="logout-btn">D√©connexion</a>
            </div>
        </div>
        
        <!-- MAIN CONTENT -->
        <div class="main-grid">
            <!-- LEFT: MEASUREMENTS + CHARTS -->
            <div>
                <!-- CARD MEASUREMENTS -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon icon-temp">¬∞C</span>
                        Mesures Actuelles
                    </div>
                    
                    <div class="measurements-grid">
                        <div class="measurement-box temp">
                            <div class="measurement-label">Temp√©rature</div>
                            <div class="measurement-value" id="temp-val">--</div>
                            <span class="measurement-unit">¬∞C</span>
                            <div class="measurement-time" id="temp-time">--</div>
                            <div class="status-badge badge-ok" id="temp-badge">Normal</div>
                            <a href="{% url 'graph_temp' %}" class="btn btn-primary" style="margin-top: 10px; width: 100%; text-align: center;">üìä Graphe</a>
                        </div>
                        
                        <div class="measurement-box hum">
                            <div class="measurement-label">Humidit√©</div>
                            <div class="measurement-value" id="hum-val">--</div>
                            <span class="measurement-unit">%</span>
                            <div class="measurement-time" id="hum-time">--</div>
                            <div class="status-badge badge-ok" id="hum-badge">Normal</div>
                            <a href="{% url 'graph_hum' %}" class="btn btn-primary" style="margin-top: 10px; width: 100%; text-align: center;">üìä Graphe</a>
                        </div>
                    </div>
                    
                    <!-- BUTTONS -->
                    <div class="links-grid">
                        <a href="{% url 'incident_archive' %}" class="btn btn-primary" style="grid-column: 1/-1;">üìã Archive</a>
                    </div>
                </div>
            </div>
            
            <!-- RIGHT: STATUS + OPERATORS -->
            <div>
                <!-- INCIDENT STATUS -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon icon-incident">‚ö†Ô∏è</span>
                        √âtat
                    </div>
                    
                    <div class="incident-box incident-ok" id="incident-box">
                        <div class="incident-title" id="incident-title">‚úì Syst√®me Normal</div>
                        <div class="incident-info">
                            <strong>Compteur:</strong> <span id="counter">0</span><br>
                            <strong>Alert√©s:</strong> <span id="incident-status">Pas d'incident</span><br>
                            <strong>Max Temp:</strong> <span id="max-temp">--</span>¬∞C<br>
                            <strong>Dur√©e:</strong> <span id="duration">--</span><br>
                            <strong>Perte:</strong> <span id="product-loss">Non</span>
                        </div>
                    </div>
                    
                    <!-- OPERATORS -->
                    <div class="operators-grid" id="operators-container"></div>
                </div>
            </div>
        </div>
        
        <!-- API TESTER -->
        <div class="api-section">
            <h3>üîå Testeur API</h3>
            <div class="api-inputs">
                <div class="api-input-group">
                    <label for="api-temp">Temp√©rature (¬∞C)</label>
                    <input type="number" id="api-temp" placeholder="Ex: 5" step="0.1">
                </div>
                <div class="api-input-group">
                    <label for="api-hum">Humidit√© (%)</label>
                    <input type="number" id="api-hum" placeholder="Ex: 65" step="0.1">
                </div>
            </div>
            <button class="btn-send" onclick="sendAPI()">Envoyer vers /api/post</button>
            <div class="api-response" id="api-response"></div>
        </div>
    </div>
    
    <!-- ALERTS -->
    <div class="alerts-container" id="alerts"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@latest"></script>
    <script>
        let tempChart, humChart;
        const MAX_POINTS = 20;
        
        document.addEventListener('DOMContentLoaded', () => {
            updateData();
            setInterval(updateData, 3000);
        });
        
        async function updateData() {
            try {
                const [latest, incident] = await Promise.all([
                    fetch('/latest/').then(r => r.json()),
                    fetch('/incident/status/').then(r => r.json())
                ]);
                
                // Update measurements
                const temp = latest.temp || latest.temperature || 0;
                const hum = latest.hum || latest.humidity || 0;
                const time = latest.dt || latest.timestamp ? new Date(latest.dt || latest.timestamp).toLocaleTimeString('fr-FR') : '--';
                
                document.getElementById('temp-val').textContent = temp.toFixed(1);
                document.getElementById('hum-val').textContent = hum.toFixed(1);
                document.getElementById('temp-time').textContent = time;
                document.getElementById('hum-time').textContent = time;
                
                // Alert status
                const isAlert = temp < 2 || temp > 8;
                const tempBadge = document.getElementById('temp-badge');
                tempBadge.textContent = isAlert ? 'üî¥ ALERTE' : '‚úì Normal';
                tempBadge.className = isAlert ? 'status-badge badge-alert' : 'status-badge badge-ok';
                
                // Update incident status
                updateIncidentStatus(incident);
                updateOperators(incident);
                
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        function updateIncidentStatus(incident) {
            const box = document.getElementById('incident-box');
            const title = document.getElementById('incident-title');
            
            if (incident.is_open) {
                box.className = 'incident-box incident-alert';
                title.textContent = '‚ö†Ô∏è INCIDENT EN COURS';
                
                // Afficher les op√©rateurs alert√©s selon le niveau d'escalade
                let operators = 'OP1';
                if (incident.escalation_level >= 4) operators += ' + OP2';
                if (incident.escalation_level >= 7) operators += ' + OP3';
                document.getElementById('incident-status').textContent = `Alert√©s: ${operators}`;
            } else {
                box.className = 'incident-box incident-ok';
                title.textContent = '‚úì Syst√®me Normal';
                document.getElementById('incident-status').textContent = 'Pas d\'incident';
            }
            
            document.getElementById('counter').textContent = incident.escalation_level || 0;
            document.getElementById('max-temp').textContent = incident.max_temp ? incident.max_temp.toFixed(1) : '--';
            
            // Duration
            if (incident.start_at) {
                const start = new Date(incident.start_at);
                const end = incident.end_at ? new Date(incident.end_at) : new Date();
                const diff = Math.round((end - start) / 60000);
                document.getElementById('duration').textContent = diff < 60 ? diff + 'm' : (diff/60).toFixed(1) + 'h';
            } else {
                document.getElementById('duration').textContent = '--';
            }
            
            document.getElementById('product-loss').textContent = incident.is_product_lost ? '‚ö†Ô∏è OUI' : 'Non';
        }
        
        function updateOperators(incident) {
            const container = document.getElementById('operators-container');
            
            // LOGIQUE : 
            // Niveau d'escalade 1-3 : OP1 seul
            // Niveau d'escalade 4-6 : OP1 + OP2
            // Niveau d'escalade 7+ : OP1 + OP2 + OP3
            
            const showOp1 = incident.escalation_level >= 1;
            const showOp2 = incident.escalation_level >= 4;
            const showOp3 = incident.escalation_level >= 7;
            
            for (let level = 1; level <= 3; level++) {
                let show = false;
                if (level === 1) show = showOp1;
                else if (level === 2) show = showOp2;
                else if (level === 3) show = showOp3;
                
                const respondedKey = `op${level}_responded`;
                const comKey = `op${level}_comment`;
                const timeKey = `op${level}_responded_at`;
                
                const hasResponded = incident[respondedKey];
                const statusText = hasResponded ? '‚úì A r√©agi' : '‚è≥ En attente';
                
                // V√©rifier si cette carte existe d√©j√†
                let card = document.querySelector(`[data-level="${level}"]`)?.closest('.op-card');
                
                if (!show) {
                    // Supprimer si elle doit √™tre cach√©e
                    if (card) card.remove();
                    continue;
                }
                
                if (card) {
                    // Mise √† jour des champs qui peuvent changer
                    const statusDiv = card.querySelector('[style*="Statut"]') || card.querySelector('div:nth-child(3)');
                    if (statusDiv) {
                        statusDiv.innerHTML = `Statut: <strong>${statusText}</strong>`;
                    }
                    
                    // NE PAS r√©initialiser la checkbox et textarea - garder les valeurs locales
                    const checkbox = card.querySelector('.op-responded-check');
                    const textarea = card.querySelector('.op-comment');
                    
                    // Mettre √† jour disabled uniquement
                    checkbox.disabled = !incident.is_open;
                    textarea.disabled = !incident.is_open;
                    
                    // Mettre √† jour le timestamp s'il a chang√©
                    const savedDiv = card.querySelector('.op-saved');
                    if (incident[timeKey]) {
                        if (savedDiv) {
                            savedDiv.textContent = `R√©agi le: ${new Date(incident[timeKey]).toLocaleString('fr-FR')}`;
                        } else {
                            const newSaved = document.createElement('div');
                            newSaved.className = 'op-saved';
                            newSaved.textContent = `R√©agi le: ${new Date(incident[timeKey]).toLocaleString('fr-FR')}`;
                            card.appendChild(newSaved);
                        }
                    }
                } else {
                    // Cr√©er une nouvelle carte
                    const newCard = document.createElement('div');
                    newCard.className = `op-card ${incident.is_open ? 'active' : ''}`;
                    newCard.innerHTML = `
                        <div class="op-header">
                            <div class="op-level">${level}</div>
                            <div class="op-name">Op√©rateur ${level}</div>
                        </div>
                        <div style="font-size: 11px; color: #666; margin-bottom: 10px;">
                            Statut: <strong>${statusText}</strong>
                        </div>
                        <label class="op-ack">
                            <input type="checkbox" class="op-responded-check" data-level="${level}" 
                                ${hasResponded ? 'checked' : ''} 
                                ${incident.is_open ? '' : 'disabled'}>
                            <span>J'ai vu l'incident</span>
                        </label>
                        <textarea class="op-comment" data-level="${level}" 
                            placeholder="D√©crivez l'action que vous avez prise..."
                            ${incident.is_open ? '' : 'disabled'}>${incident[comKey] || ''}</textarea>
                        <button class="btn-validate" onclick="validateOp(${level})" 
                            ${incident.is_open ? '' : 'disabled'}>‚úì Confirmer</button>
                        ${incident[timeKey] ? `<div class="op-saved">R√©agi le: ${new Date(incident[timeKey]).toLocaleString('fr-FR')}</div>` : ''}
                    `;
                    container.appendChild(newCard);
                }
            }
        }
        
        function validateOp(level) {
            const checkbox = document.querySelector(`[data-level="${level}"].op-responded-check`);
            const textarea = document.querySelector(`.op-comment[data-level="${level}"]`);
            const card = checkbox.closest('.op-card');
            const button = card.querySelector('.btn-validate');
            
            const responded = checkbox.checked;
            const comment = textarea.value.trim();
            
            console.log(`üîµ validateOp(${level}): responded=${responded}, comment="${comment}"`);
            
            // Validation stricte : case coch√©e ET commentaire obligatoire
            if (!responded) {
                showAlert('‚ùå Veuillez cocher "J\'ai vu l\'incident"', 'error');
                return;
            }
            
            if (!comment) {
                showAlert('‚ùå Veuillez d√©crire l\'action que vous avez prise', 'error');
                return;
            }
            
            // D√©sactiver imm√©diatement le formulaire et le bouton
            checkbox.disabled = true;
            textarea.disabled = true;
            button.disabled = true;
            button.textContent = '‚è≥ Enregistrement...';
            
            // Mettre √† jour le statut imm√©diatement
            const statusDiv = card.querySelector('div:nth-child(3)');
            if (statusDiv) {
                statusDiv.innerHTML = `Statut: <strong>‚úì A r√©agi</strong>`;
            }
            
            const payload = {op: level, responded: responded, comment: comment};
            console.log(`üì§ Envoi √† /incident/update/:`, JSON.stringify(payload));
            
            fetch('/incident/update/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken')},
                body: JSON.stringify(payload)
            })
            .then(r => {
                console.log(`üì• R√©ponse re√ßue: status=${r.status}`);
                if (!r.ok) {
                    throw new Error(`HTTP ${r.status}`);
                }
                return r.json();
            })
            .then(data => {
                console.log(`‚úÖ Data re√ßue:`, data);
                showAlert('‚úì Enregistr√© et confirm√©', 'success');
                button.textContent = '‚úì Confirm√©';
                // Masquer compl√®tement la carte apr√®s confirmation
                setTimeout(() => {
                    card.style.opacity = '0';
                    card.style.transition = 'opacity 0.3s';
                    setTimeout(() => card.remove(), 300);
                }, 1000);
                // Mettre √† jour les donn√©es apr√®s 1.5s
                setTimeout(updateData, 1500);
            })
            .catch(e => {
                console.error(`‚ùå Erreur:`, e);
                showAlert('‚úó Erreur: ' + e.message, 'error');
                // R√©activer en cas d'erreur
                checkbox.disabled = false;
                textarea.disabled = false;
                button.disabled = false;
                button.textContent = '‚úì Confirmer';
            });
        }
        
        function sendAPI() {
            const temp = parseFloat(document.getElementById('api-temp').value);
            const hum = parseFloat(document.getElementById('api-hum').value);
            
            if (isNaN(temp) || isNaN(hum)) {
                showAlert('Valeurs invalides', 'error');
                return;
            }
            
            fetch('/api/post', {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken')},
                body: JSON.stringify({temp, hum})
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById('api-response').className = 'api-response show success';
                document.getElementById('api-response').textContent = JSON.stringify(data, null, 2);
                showAlert('‚úì Envoy√© avec succ√®s', 'success');
                setTimeout(updateData, 500);
            })
            .catch(e => {
                document.getElementById('api-response').className = 'api-response show error';
                document.getElementById('api-response').textContent = e.message;
                showAlert('‚úó Erreur', 'error');
            });
        }
        
        function showAlert(msg, type) {
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.textContent = msg;
            document.getElementById('alerts').appendChild(alert);
            setTimeout(() => alert.remove(), 3000);
        }
        
        function getCookie(name) {
            let val = null;
            if (document.cookie) {
                document.cookie.split(';').forEach(c => {
                    c = c.trim();
                    if (c.startsWith(name + '=')) val = decodeURIComponent(c.substring(name.length + 1));
                });
            }
            return val;
        }
    </script>
</body>
</html>
